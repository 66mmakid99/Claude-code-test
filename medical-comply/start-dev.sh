#!/bin/bash

# MedicalComply ê°œë°œ ì„œë²„ ì‹œìž‘ ìŠ¤í¬ë¦½íŠ¸

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                   â•‘"
echo "â•‘   ðŸ¥ MedicalComply ê°œë°œ ì„œë²„ ì‹œìž‘                 â•‘"
echo "â•‘                                                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬
PROJECT_DIR="$(cd "$(dirname "$0")" && pwd)"

# ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ë° ì‹œìž‘
echo "ðŸ“¦ ë°±ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
cd "$PROJECT_DIR/backend"
npm install --silent 2>/dev/null

echo "ðŸš€ ë°±ì—”ë“œ ì„œë²„ ì‹œìž‘ ì¤‘... (í¬íŠ¸ 5000)"
npm run dev &
BACKEND_PID=$!

# ìž ì‹œ ëŒ€ê¸°
sleep 2

# í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ë° ì‹œìž‘
echo "ðŸ“¦ í”„ë¡ íŠ¸ì—”ë“œ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
cd "$PROJECT_DIR/frontend"
npm install --silent 2>/dev/null

echo "ðŸš€ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œìž‘ ì¤‘... (í¬íŠ¸ 5173)"
npm run dev &
FRONTEND_PID=$!

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âœ… ì„œë²„ ì‹œìž‘ ì™„ë£Œ!"
echo ""
echo "   ðŸŒ í”„ë¡ íŠ¸ì—”ë“œ: http://localhost:5173"
echo "   ðŸ”Œ ë°±ì—”ë“œ API: http://localhost:5000"
echo ""
echo "   âš ï¸  Mock DB ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ (ë°ì´í„°ë² ì´ìŠ¤ ì—†ìŒ)"
echo "   ðŸ“ í…ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ íšŒì›ê°€ìž… í›„ ì‚¬ìš©í•˜ì„¸ìš”"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ì¢…ë£Œí•˜ë ¤ë©´ Ctrl+Cë¥¼ ëˆ„ë¥´ì„¸ìš”..."

# ì¢…ë£Œ ì‹œ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
cleanup() {
  echo ""
  echo "ì„œë²„ ì¢…ë£Œ ì¤‘..."
  kill $BACKEND_PID 2>/dev/null
  kill $FRONTEND_PID 2>/dev/null
  exit 0
}

trap cleanup SIGINT SIGTERM

# ëŒ€ê¸°
wait
