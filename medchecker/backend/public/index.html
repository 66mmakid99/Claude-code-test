<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MEDCHECKER - ì˜ë£Œê´‘ê³  ìœ„ë°˜ ë¶„ì„ ë°ëª¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 40px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      background: linear-gradient(90deg, #00d4ff, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .header p {
      color: #94a3b8;
      font-size: 1.1rem;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 1.8rem;
      color: #00d4ff;
      margin-bottom: 5px;
    }

    .stat-card p {
      color: #94a3b8;
      font-size: 0.85rem;
    }

    /* Input Section */
    .input-section {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .input-section h2 {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: #e2e8f0;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      padding: 10px 20px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #94a3b8;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: rgba(0, 212, 255, 0.2);
      border-color: #00d4ff;
      color: #00d4ff;
    }

    .tab-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    /* Input Fields */
    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #94a3b8;
      font-size: 0.9rem;
    }

    .url-input {
      width: 100%;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
    }

    .url-input:focus {
      outline: none;
      border-color: #00d4ff;
    }

    .url-input::placeholder {
      color: #64748b;
    }

    textarea {
      width: 100%;
      height: 200px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      color: #fff;
      font-size: 0.95rem;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: #00d4ff;
    }

    .sample-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .sample-btn {
      padding: 8px 16px;
      background: rgba(124, 58, 237, 0.2);
      border: 1px solid rgba(124, 58, 237, 0.5);
      border-radius: 20px;
      color: #c4b5fd;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .sample-btn:hover {
      background: rgba(124, 58, 237, 0.4);
    }

    .analyze-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(90deg, #00d4ff, #7c3aed);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .analyze-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
    }

    .analyze-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* AI Badge */
    .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(124, 58, 237, 0.2);
      border: 1px solid rgba(124, 58, 237, 0.5);
      border-radius: 20px;
      color: #c4b5fd;
      font-size: 0.8rem;
      margin-bottom: 15px;
    }

    .ai-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Result Section */
    .result-section {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      padding: 25px;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .result-header h2 {
      font-size: 1.3rem;
      color: #e2e8f0;
    }

    .source-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(0, 212, 255, 0.1);
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 8px;
      color: #00d4ff;
      text-decoration: none;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .source-link:hover {
      background: rgba(0, 212, 255, 0.2);
    }

    /* ìœ„ë°˜ ì˜ì—­ ë³´ê¸° ë²„íŠ¼ */
    .view-violations-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: linear-gradient(90deg, #7c3aed, #a855f7);
      border: none;
      border-radius: 8px;
      color: #fff;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      margin-top: 15px;
    }

    .view-violations-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
    }

    .view-violations-btn svg {
      width: 18px;
      height: 18px;
    }

    .result-placeholder {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
    }

    .result-placeholder svg {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    /* Result Summary */
    .result-summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }

    @media (max-width: 768px) {
      .result-summary {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .summary-card {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
    }

    .summary-card.high-risk {
      border-left: 4px solid #ef4444;
    }

    .summary-card.medium-risk {
      border-left: 4px solid #f59e0b;
    }

    .summary-card.low-risk {
      border-left: 4px solid #22c55e;
    }

    .summary-card h4 {
      font-size: 1.8rem;
      margin-bottom: 5px;
    }

    .summary-card p {
      font-size: 0.85rem;
      color: #94a3b8;
    }

    /* Violation Cards - Accordion Style */
    .violations-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .violation-card {
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      overflow: hidden;
      border-left: 4px solid #ef4444;
    }

    .violation-card.warning {
      border-left-color: #f59e0b;
    }

    .violation-card.info {
      border-left-color: #3b82f6;
    }

    .violation-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0,0,0,0.2);
      cursor: pointer;
      transition: background 0.2s;
    }

    .violation-card-header:hover {
      background: rgba(0,0,0,0.3);
    }

    .violation-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .expand-icon {
      width: 20px;
      height: 20px;
      transition: transform 0.3s;
    }

    .violation-card.expanded .expand-icon {
      transform: rotate(180deg);
    }

    .violation-title {
      font-weight: 600;
      color: #f1f5f9;
      font-size: 1rem;
    }

    .severity-badge {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .severity-badge.critical {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
    }

    .severity-badge.warning {
      background: rgba(245, 158, 11, 0.2);
      color: #fcd34d;
    }

    .severity-badge.info {
      background: rgba(59, 130, 246, 0.2);
      color: #93c5fd;
    }

    .violation-card-body {
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    }

    .violation-card.expanded .violation-card-body {
      padding: 20px;
      max-height: 2000px;
    }

    /* Source URL Box */
    .source-url-box {
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 8px;
      padding: 10px 15px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .source-url-box .label {
      color: #94a3b8;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .source-url-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #00d4ff;
      text-decoration: none;
      font-size: 0.85rem;
      word-break: break-all;
      transition: all 0.2s;
    }

    .source-url-link:hover {
      color: #38bdf8;
      text-decoration: underline;
    }

    .source-url-link svg {
      flex-shrink: 0;
    }

    /* Violation Text Highlight */
    .violation-text-highlight {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 8px;
      padding: 12px 15px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .violation-text-highlight .label {
      color: #94a3b8;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .violation-text-highlight .matched-text {
      background: linear-gradient(90deg, rgba(239, 68, 68, 0.4), rgba(239, 68, 68, 0.2));
      border-bottom: 2px solid #ef4444;
      padding: 4px 10px;
      border-radius: 4px;
      color: #fca5a5;
      font-weight: 700;
      font-size: 1rem;
    }

    .violation-text-highlight .matched-text.warning {
      background: linear-gradient(90deg, rgba(245, 158, 11, 0.4), rgba(245, 158, 11, 0.2));
      border-bottom-color: #f59e0b;
      color: #fcd34d;
    }

    /* Extended Context Block */
    .extended-context {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
      font-size: 0.9rem;
      line-height: 1.8;
      color: #94a3b8;
    }

    .extended-context::before {
      content: 'ì£¼ë³€ ë¬¸ë§¥';
      position: absolute;
      top: -10px;
      left: 10px;
      background: #1a1a2e;
      padding: 0 8px;
      font-size: 0.75rem;
      color: #64748b;
    }

    .extended-context .context-text {
      color: #94a3b8;
    }

    .extended-context .context-text.no-context {
      color: #64748b;
      font-style: italic;
    }

    .extended-context .highlight-mark {
      background: linear-gradient(90deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.15));
      border-bottom: 2px solid #ef4444;
      padding: 2px 4px;
      border-radius: 3px;
      color: #fca5a5;
      font-weight: 600;
    }

    .extended-context .highlight-mark.warning {
      background: linear-gradient(90deg, rgba(245, 158, 11, 0.3), rgba(245, 158, 11, 0.15));
      border-bottom-color: #f59e0b;
      color: #fcd34d;
    }

    /* Violation Sections */
    .violation-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .violation-section:first-of-type {
      margin-top: 0;
      padding-top: 0;
      border-top: none;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #00d4ff;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .section-title svg {
      width: 16px;
      height: 16px;
    }

    .section-title .legal-link {
      margin-left: auto;
      font-size: 0.75rem;
      color: #94a3b8;
      text-decoration: none;
      padding: 4px 8px;
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
      transition: all 0.2s;
    }

    .section-title .legal-link:hover {
      color: #00d4ff;
      background: rgba(0, 212, 255, 0.1);
    }

    /* Legal Info Grid */
    .legal-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 768px) {
      .legal-grid {
        grid-template-columns: 1fr;
      }
    }

    .legal-item {
      background: rgba(0,0,0,0.2);
      padding: 12px;
      border-radius: 8px;
    }

    .legal-item h5 {
      font-size: 0.75rem;
      color: #64748b;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .legal-item p {
      font-size: 0.9rem;
      color: #cbd5e1;
    }

    /* Fix Guide Section */
    .fix-guide {
      background: rgba(34, 197, 94, 0.05);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 8px;
      padding: 15px;
    }

    .fix-steps {
      margin-bottom: 15px;
    }

    .fix-step {
      display: flex;
      gap: 10px;
      padding: 8px 0;
      font-size: 0.9rem;
      color: #e2e8f0;
    }

    .fix-step-number {
      background: rgba(34, 197, 94, 0.2);
      color: #86efac;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .examples-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 768px) {
      .examples-grid {
        grid-template-columns: 1fr;
      }
    }

    .example-box {
      padding: 12px;
      border-radius: 8px;
    }

    .example-box.bad {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .example-box.good {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .example-label {
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .example-box.bad .example-label {
      color: #fca5a5;
    }

    .example-box.good .example-label {
      color: #86efac;
    }

    .example-text {
      font-size: 0.85rem;
      color: #cbd5e1;
      line-height: 1.5;
    }

    /* Related Cases Section */
    .case-card {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
    }

    .case-card:last-child {
      margin-bottom: 0;
    }

    .case-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .case-title {
      font-size: 0.9rem;
      color: #f1f5f9;
      font-weight: 500;
    }

    .case-penalty {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
    }

    .case-meta {
      font-size: 0.8rem;
      color: #64748b;
      margin-bottom: 6px;
    }

    .case-summary {
      font-size: 0.85rem;
      color: #94a3b8;
      line-height: 1.5;
    }

    /* Screenshot Section */
    .screenshot-container {
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }

    .screenshot-image {
      max-width: 100%;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .screenshot-placeholder {
      padding: 30px;
      color: #64748b;
      font-size: 0.9rem;
    }

    /* Tips List */
    .tips-list {
      list-style: none;
    }

    .tips-list li {
      display: flex;
      gap: 8px;
      padding: 6px 0;
      font-size: 0.85rem;
      color: #cbd5e1;
    }

    .tips-list li::before {
      content: 'ğŸ’¡';
      flex-shrink: 0;
    }

    /* Success Message */
    .success-message {
      text-align: center;
      padding: 60px 20px;
    }

    .success-icon {
      width: 100px;
      height: 100px;
      background: rgba(34, 197, 94, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .success-icon svg {
      width: 50px;
      height: 50px;
      color: #22c55e;
    }

    .success-message h3 {
      color: #22c55e;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .success-message p {
      color: #94a3b8;
      font-size: 1rem;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.1);
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-steps {
      margin-top: 20px;
      text-align: left;
      display: inline-block;
    }

    .loading-step {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      color: #64748b;
      font-size: 0.9rem;
    }

    .loading-step.active {
      color: #00d4ff;
    }

    .loading-step.done {
      color: #22c55e;
    }

    .loading-step-icon {
      width: 20px;
      height: 20px;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 30px 0;
      margin-top: 40px;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: #64748b;
      font-size: 0.85rem;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Metadata Box */
    .metadata-box {
      background: rgba(0, 212, 255, 0.05);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .metadata-box h4 {
      font-size: 0.85rem;
      color: #00d4ff;
      margin-bottom: 10px;
    }

    .metadata-item {
      display: flex;
      margin-bottom: 5px;
    }

    .metadata-item span:first-child {
      color: #64748b;
      width: 80px;
      flex-shrink: 0;
    }

    .metadata-item span:last-child {
      color: #e2e8f0;
      word-break: break-all;
    }

    /* Confidence Meter */
    .confidence-meter {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .confidence-bar {
      flex: 1;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .confidence-fill {
      height: 100%;
      border-radius: 3px;
      transition: width 0.3s;
    }

    .confidence-fill.high {
      background: #ef4444;
    }

    .confidence-fill.medium {
      background: #f59e0b;
    }

    .confidence-fill.low {
      background: #22c55e;
    }

    .confidence-text {
      font-size: 0.85rem;
      color: #94a3b8;
      min-width: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>MEDCHECKER</h1>
      <p>ì˜ë£Œê´‘ê³  ìœ„ë°˜ íƒì§€ ì‹œìŠ¤í…œ - ë¬¸ë§¥ ê¸°ë°˜ AI ë¶„ì„</p>
    </header>

    <!-- Stats -->
    <div class="stats-grid" id="stats">
      <div class="stat-card">
        <h3 id="totalRules">-</h3>
        <p>ì´ ê·œì¹™ ìˆ˜</p>
      </div>
      <div class="stat-card">
        <h3 id="medicalRules">-</h3>
        <p>ì˜ë£Œê´‘ê³  ê·œì¹™</p>
      </div>
      <div class="stat-card">
        <h3 id="viralRules">-</h3>
        <p>ë°”ì´ëŸ´ ëª¨ë‹ˆí„°ë§</p>
      </div>
      <div class="stat-card">
        <h3 id="aiProviders">-</h3>
        <p>AI Providers</p>
      </div>
    </div>

    <!-- Input Section -->
    <div class="input-section">
      <h2>ë¶„ì„ ëŒ€ìƒ ì…ë ¥</h2>
      
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('url')">URL ë¶„ì„</button>
        <button class="tab-btn" onclick="switchTab('text')">í…ìŠ¤íŠ¸ ë¶„ì„</button>
      </div>

      <!-- URL Input -->
      <div id="urlTab" class="tab-content active">
        <div class="input-group">
          <label>ë³‘ì› ì›¹ì‚¬ì´íŠ¸ URL</label>
          <input type="url" class="url-input" id="urlInput" placeholder="https://example-hospital.com">
        </div>
      </div>

      <!-- Text Input -->
      <div id="textTab" class="tab-content">
        <div class="sample-buttons" id="sampleButtons">
          <!-- ìƒ˜í”Œ ë²„íŠ¼ -->
        </div>
        <textarea id="textInput" placeholder="ë¶„ì„í•  ì˜ë£Œê´‘ê³  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
      </div>

      <!-- AI Always On Badge -->
      <div class="ai-badge">
        AI ë¶„ì„ í™œì„±í™”ë¨ (Gemini + Claude)
      </div>

      <button class="analyze-btn" id="analyzeBtn" onclick="analyze()">
        ë¶„ì„ ì‹œì‘
      </button>
    </div>

    <!-- Result Section -->
    <div class="result-section">
      <div class="result-header">
        <h2>ë¶„ì„ ê²°ê³¼</h2>
        <a href="#" class="source-link" id="sourceLink" style="display: none;" target="_blank">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
          ì›ë³¸ í˜ì´ì§€ ì—´ê¸°
        </a>
      </div>
      <div id="resultContent">
        <div class="result-placeholder">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
          </svg>
          <p>URLì„ ì…ë ¥í•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•œ í›„<br>"ë¶„ì„ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>MEDCHECKER v0.2.0 - ì˜ë£Œê´‘ê³  ìœ„ë°˜ íƒì§€ ì‹œìŠ¤í…œ</p>
      <p>ì˜ë£Œë²• ì œ56ì¡° ê¸°ë°˜ / ë¬¸ë§¥ ì¸ì‹ ê·œì¹™ ì—”ì§„ + AI ê²€ì¦</p>
    </footer>
  </div>

  <script>
    let currentTab = 'url';
    let currentSourceUrl = null;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      loadStats();
      loadSamples();
    });

    // íƒ­ ì „í™˜
    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tab + 'Tab').classList.add('active');
    }

    // í†µê³„ ë¡œë“œ
    async function loadStats() {
      try {
        const response = await fetch('/api/stats');
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('totalRules').textContent = data.stats.totalRules;
          document.getElementById('medicalRules').textContent = data.stats.medicalAdRules;
          document.getElementById('viralRules').textContent = data.stats.viralMonitoringRules;
          document.getElementById('aiProviders').textContent = data.aiProviders.length;
        }
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ
    async function loadSamples() {
      try {
        const response = await fetch('/api/samples');
        const data = await response.json();
        
        if (data.success) {
          const container = document.getElementById('sampleButtons');
          container.innerHTML = data.samples.map((sample, i) => 
            `<button class="sample-btn" onclick="loadSample(${i})">${sample.name}</button>`
          ).join('');
          
          window.sampleData = data.samples;
        }
      } catch (error) {
        console.error('Failed to load samples:', error);
      }
    }

    // ìƒ˜í”Œ í…ìŠ¤íŠ¸ ë¡œë“œ
    function loadSample(index) {
      if (window.sampleData && window.sampleData[index]) {
        document.getElementById('textInput').value = window.sampleData[index].text;
        switchTab('text');
        document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        document.querySelector('.tab-btn:nth-child(1)').classList.remove('active');
        document.getElementById('urlTab').classList.remove('active');
        document.getElementById('textTab').classList.add('active');
      }
    }

    // URL ì •ê·œí™” (http:// ìë™ ì¶”ê°€)
    function normalizeUrl(url) {
      if (!url) return '';
      url = url.trim();
      
      // ì´ë¯¸ í”„ë¡œí† ì½œì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
      if (url.startsWith('http://') || url.startsWith('https://')) {
        return url;
      }
      
      // í”„ë¡œí† ì½œì´ ì—†ìœ¼ë©´ https:// ì¶”ê°€ (ë” ì•ˆì „)
      return 'https://' + url;
    }

    // ë¶„ì„ ì‹¤í–‰ (AI í•­ìƒ í™œì„±í™”)
    async function analyze() {
      const enableAI = true; // í•­ìƒ í™œì„±í™”
      const btn = document.getElementById('analyzeBtn');
      const resultContent = document.getElementById('resultContent');
      const sourceLink = document.getElementById('sourceLink');

      let endpoint, body;

      if (currentTab === 'url') {
        let url = document.getElementById('urlInput').value.trim();
        if (!url) {
          alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        // URL ì •ê·œí™” (http:// ìë™ ì¶”ê°€)
        url = normalizeUrl(url);
        
        // ì…ë ¥ í•„ë“œì— ì •ê·œí™”ëœ URL í‘œì‹œ
        document.getElementById('urlInput').value = url;
        
        endpoint = '/api/analyze-url';
        body = { url, enableAI };
        currentSourceUrl = url;
      } else {
        const text = document.getElementById('textInput').value.trim();
        if (!text) {
          alert('ë¶„ì„í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        endpoint = '/api/analyze';
        body = { text, enableAI };
        currentSourceUrl = null;
      }

      // ë¡œë”© ìƒíƒœ
      btn.disabled = true;
      btn.textContent = 'ë¶„ì„ ì¤‘...';
      sourceLink.style.display = 'none';
      resultContent.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>${currentTab === 'url' ? 'ì›¹ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘...' : 'í…ìŠ¤íŠ¸ ë¶„ì„ ì¤‘...'}</p>
          <div class="loading-steps">
            <div class="loading-step active" id="step1">
              <span class="loading-step-icon">â³</span>
              ${currentTab === 'url' ? 'ì›¹ì‚¬ì´íŠ¸ í¬ë¡¤ë§' : 'í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬'}
            </div>
            <div class="loading-step" id="step2">
              <span class="loading-step-icon">â³</span>
              ê·œì¹™ ê¸°ë°˜ ë¶„ì„
            </div>
            <div class="loading-step" id="step3">
              <span class="loading-step-icon">â³</span>
              AI ë¬¸ë§¥ ê²€ì¦
            </div>
          </div>
        </div>
      `;

      // ë¡œë”© ë‹¨ê³„ ì‹œë®¬ë ˆì´ì…˜
      setTimeout(() => {
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        if (step1) {
          step1.classList.remove('active');
          step1.classList.add('done');
          const icon1 = step1.querySelector('.loading-step-icon');
          if (icon1) icon1.textContent = 'âœ“';
        }
        if (step2) step2.classList.add('active');
      }, 1000);
      setTimeout(() => {
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        if (step2) {
          step2.classList.remove('active');
          step2.classList.add('done');
          const icon2 = step2.querySelector('.loading-step-icon');
          if (icon2) icon2.textContent = 'âœ“';
        }
        if (step3) step3.classList.add('active');
      }, 2000);

      try {
        const response = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body),
        });

        const data = await response.json();

        if (data.success) {
          renderResult(data);
          
          // ì›ë³¸ ë§í¬ í‘œì‹œ
          if (currentSourceUrl) {
            sourceLink.href = currentSourceUrl;
            sourceLink.style.display = 'flex';
          }
        } else {
          resultContent.innerHTML = `
            <div class="result-placeholder">
              <p style="color: #ef4444;">ì˜¤ë¥˜: ${data.error}</p>
              ${data.detail ? `<p style="color: #94a3b8; font-size: 0.85rem; margin-top: 10px;">${data.detail}</p>` : ''}
            </div>
          `;
        }
      } catch (error) {
        resultContent.innerHTML = `
          <div class="result-placeholder">
            <p style="color: #ef4444;">ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</p>
            <p style="color: #94a3b8; font-size: 0.85rem; margin-top: 10px;">${error.message}</p>
          </div>
        `;
      } finally {
        btn.disabled = false;
        btn.textContent = 'ë¶„ì„ ì‹œì‘';
      }
    }

    // ê²°ê³¼ ë Œë”ë§
    function renderResult(data) {
      const resultContent = document.getElementById('resultContent');
      const result = data.result;
      const raw = data.raw;

      // ìœ„ë°˜ì´ ì—†ëŠ” ê²½ìš°
      if (result.summary.violationsCount === 0 && result.summary.warningsCount === 0) {
        resultContent.innerHTML = `
          ${data.metadata ? renderMetadata(data) : ''}
          <div class="success-message">
            <div class="success-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <h3>ìœ„ë°˜ ì‚¬í•­ ì—†ìŒ</h3>
            <p>ë¶„ì„ ê²°ê³¼ ì˜ë£Œê´‘ê³ ë²• ìœ„ë°˜ìœ¼ë¡œ ì˜ì‹¬ë˜ëŠ” í‘œí˜„ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
            <p style="margin-top: 15px; color: #22c55e; font-size: 1.2rem;">ì ìˆ˜: ${result.summary.score}ì </p>
          </div>
        `;
        return;
      }

      // ê²°ê³¼ ìš”ì•½
      const riskClass = result.summary.riskLevel === 'high' ? 'high-risk' : 
                       result.summary.riskLevel === 'medium' ? 'medium-risk' : 'low-risk';
      
      let html = '';

      // ë©”íƒ€ë°ì´í„° (URL ë¶„ì„ì˜ ê²½ìš°)
      if (data.metadata) {
        html += renderMetadata(data);
      }

      // ìš”ì•½ ì¹´ë“œ
      html += `
        <div class="result-summary">
          <div class="summary-card ${riskClass}">
            <h4 style="color: ${result.summary.riskLevel === 'high' ? '#ef4444' : result.summary.riskLevel === 'medium' ? '#f59e0b' : '#22c55e'}">${result.summary.score}</h4>
            <p>ì ìˆ˜</p>
          </div>
          <div class="summary-card high-risk">
            <h4 style="color: #ef4444">${result.summary.violationsCount}</h4>
            <p>ìœ„ë°˜</p>
          </div>
          <div class="summary-card medium-risk">
            <h4 style="color: #f59e0b">${result.summary.warningsCount}</h4>
            <p>ê²½ê³ </p>
          </div>
          <div class="summary-card">
            <h4 style="color: #94a3b8">${data.processingTimeMs || 0}ms</h4>
            <p>ì²˜ë¦¬ ì‹œê°„</p>
          </div>
        </div>

        <p style="margin-bottom: 15px; padding: 10px 15px; background: rgba(0,0,0,0.3); border-radius: 8px; color: #f1f5f9;">
          <strong>ìœ„í—˜ë„:</strong> <span style="color: ${result.summary.riskLevel === 'high' ? '#ef4444' : result.summary.riskLevel === 'medium' ? '#f59e0b' : '#22c55e'}">${result.summary.riskLabel}</span>
        </p>

        ${currentSourceUrl && (result.summary.violationsCount > 0 || result.summary.warningsCount > 0) ? `
          <a href="${getViewerUrl(data)}" target="_blank" class="view-violations-btn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            ì‹¤ì œ í˜ì´ì§€ì—ì„œ ìœ„ë°˜ ì˜ì—­ ë³´ê¸°
          </a>
        ` : ''}

        <div class="violations-list">
      `;

      // ìœ„ë°˜ ëª©ë¡
      const violations = raw?.violations || result?.violations || [];
      for (let i = 0; i < violations.length; i++) {
        html += renderViolationCard(violations[i], i, false);
      }

      // ê²½ê³  ëª©ë¡
      const warnings = raw?.warnings || result?.warnings || [];
      if (warnings.length > 0) {
        html += `<h3 style="margin: 30px 0 15px; color: #f59e0b; font-size: 1.1rem;">ê²½ê³  ì‚¬í•­</h3>`;
        for (let i = 0; i < Math.min(warnings.length, 5); i++) {
          html += renderViolationCard(warnings[i], violations.length + i, true);
        }
        if (warnings.length > 5) {
          html += `<p style="color: #64748b; text-align: center; padding: 15px;">ì™¸ ${warnings.length - 5}ê±´ì˜ ê²½ê³ ê°€ ë” ìˆìŠµë‹ˆë‹¤.</p>`;
        }
      }

      html += '</div>';
      resultContent.innerHTML = html;

      // ì•„ì½”ë””ì–¸ ì´ë²¤íŠ¸ ë°”ì¸ë”©
      document.querySelectorAll('.violation-card-header').forEach(header => {
        header.addEventListener('click', () => {
          header.parentElement.classList.toggle('expanded');
        });
      });
    }

    // ë©”íƒ€ë°ì´í„° ë Œë”ë§
    function renderMetadata(data) {
      return `
        <div class="metadata-box">
          <h4>í˜ì´ì§€ ì •ë³´</h4>
          <div class="metadata-item">
            <span>URL</span>
            <span>${data.url || '-'}</span>
          </div>
          <div class="metadata-item">
            <span>ì œëª©</span>
            <span>${data.metadata?.title || '-'}</span>
          </div>
          <div class="metadata-item">
            <span>ì„¤ëª…</span>
            <span>${data.metadata?.description?.substring(0, 100) || '-'}${data.metadata?.description?.length > 100 ? '...' : ''}</span>
          </div>
        </div>
      `;
    }

    // ìœ„ë°˜ ì¹´ë“œ ë Œë”ë§ (í™•ì¥ ê°€ëŠ¥í•œ ì•„ì½”ë””ì–¸)
    function renderViolationCard(violation, index, isWarning = false) {
      const severityClass = violation.severity === 'critical' ? 'critical' : 
                           violation.severity === 'warning' ? 'warning' : 'info';
      
      const severityLabel = violation.severityLabel || 
                           (violation.severity === 'critical' ? 'ì‹¬ê°' : 
                           violation.severity === 'warning' ? 'ì£¼ì˜' : 'ì°¸ê³ ');

      // í™•ì¥ëœ ë¬¸ë§¥ ì •ë³´ ì²˜ë¦¬
      const extendedContext = violation.extendedContext || {};
      const contextBefore = extendedContext.before || '';
      const contextMatched = extendedContext.matched || violation.matchedText || violation.evidence || '';
      const contextAfter = extendedContext.after || '';
      const hasExtendedContext = contextBefore || contextAfter;

      // ê¸°ì¡´ ë¬¸ë§¥ (í™•ì¥ ë¬¸ë§¥ì´ ì—†ëŠ” ê²½ìš° ì‚¬ìš©)
      const contextWindow = violation.contextWindow || violation.context || '';

      // ë²•ì  ì •ë³´
      const legalBasis = violation.legal?.basis || violation.legalBasis || '-';
      const legalPenalty = violation.legal?.penalty || '-';

      // ìˆ˜ì • ê°€ì´ë“œ
      const howToFix = violation.howToFix || violation.recommendation || {};
      const fixSteps = howToFix.steps || [];
      const badExamples = howToFix.badExamples || (howToFix.example?.bad ? [howToFix.example.bad] : []);
      const goodExamples = howToFix.goodExamples || (howToFix.example?.good ? [howToFix.example.good] : []);
      const tips = howToFix.tips || [];

      // ê´€ë ¨ íŒë¡€
      const relatedCases = violation.relatedCases || [];

      // ì‹ ë¢°ë„
      const confidence = Math.round((violation.confidence || 0.7) * 100);
      const confidenceClass = confidence >= 80 ? 'high' : confidence >= 60 ? 'medium' : 'low';

      // ìœ„ë°˜ í…ìŠ¤íŠ¸ (matchedTextê°€ ìš°ì„ )
      const violationText = violation.matchedText || violation.evidence || '';

      // ì†ŒìŠ¤ URL (ìœ„ë°˜ì´ ë°œê²¬ëœ í˜ì´ì§€)
      const sourceUrl = violation.sourceUrl || currentSourceUrl || '';

      // ìŠ¤í¬ë¦°ìƒ· ë°ì´í„°
      const screenshotData = violation.screenshot?.data || violation.screenshot || null;
      
      return `
        <div class="violation-card ${isWarning ? 'warning' : ''} expanded" data-index="${index}">
          <div class="violation-card-header">
            <div class="violation-header-left">
              <svg class="expand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
              <span class="violation-title">${escapeHtml(violation.ruleName || violation.ruleId)}</span>
            </div>
            <span class="severity-badge ${severityClass}">${severityLabel}</span>
          </div>
          <div class="violation-card-body">
            
            <!-- ì†ŒìŠ¤ URL (ìœ„ë°˜ ì˜ì—­ ë§í¬) -->
            ${sourceUrl ? `
              <div class="source-url-box">
                <span class="label">ìœ„ë°˜ ë°œê²¬ ìœ„ì¹˜:</span>
                <a href="${escapeHtml(sourceUrl)}" target="_blank" class="source-url-link">
                  ${escapeHtml(sourceUrl.length > 60 ? sourceUrl.substring(0, 60) + '...' : sourceUrl)}
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </div>
            ` : ''}

            <!-- ìœ„ë°˜ í…ìŠ¤íŠ¸ (í•˜ì´ë¼ì´íŠ¸) -->
            <div class="violation-text-highlight">
              <span class="label">ìœ„ë°˜ í‘œí˜„:</span>
              <span class="matched-text ${isWarning ? 'warning' : ''}">${escapeHtml(violationText)}</span>
            </div>

            <!-- ì•ë’¤ ë¬¸ë§¥ (ì¼ë°˜ í…ìŠ¤íŠ¸) -->
            <div class="extended-context">
              ${hasExtendedContext ? `
                <span class="context-text">${escapeHtml(contextBefore)}</span>
                <mark class="highlight-mark ${isWarning ? 'warning' : ''}">${escapeHtml(violationText)}</mark>
                <span class="context-text">${escapeHtml(contextAfter)}</span>
              ` : (contextWindow ? `
                <span class="context-text">${highlightInContext(contextWindow, violationText, isWarning)}</span>
              ` : `
                <span class="context-text no-context">ë¬¸ë§¥ ì •ë³´ ì—†ìŒ</span>
              `)}
            </div>

            <!-- ë²•ì  ê·¼ê±° -->
            <div class="violation-section">
              <div class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                </svg>
                ë²•ì  ê·¼ê±°
                <a href="https://www.law.go.kr/ë²•ë ¹/ì˜ë£Œë²•" target="_blank" class="legal-link">ì˜ë£Œë²• ì „ë¬¸ ë³´ê¸° â†—</a>
              </div>
              <div class="legal-grid">
                <div class="legal-item">
                  <h5>ê·¼ê±° ë²•ë ¹</h5>
                  <p>${escapeHtml(legalBasis)}</p>
                </div>
                <div class="legal-item">
                  <h5>ì²˜ë²Œ ê·œì •</h5>
                  <p>${escapeHtml(legalPenalty)}</p>
                </div>
                <div class="legal-item">
                  <h5>ì‹ ë¢°ë„</h5>
                  <div class="confidence-meter">
                    <div class="confidence-bar">
                      <div class="confidence-fill ${confidenceClass}" style="width: ${confidence}%"></div>
                    </div>
                    <span class="confidence-text">${confidence}%</span>
                  </div>
                </div>
                <div class="legal-item">
                  <h5>ì¹´í…Œê³ ë¦¬</h5>
                  <p>${escapeHtml(violation.category || violation.subcategory || '-')}</p>
                </div>
              </div>
            </div>

            <!-- ìˆ˜ì • ê°€ì´ë“œ -->
            ${(fixSteps.length > 0 || badExamples.length > 0 || goodExamples.length > 0) ? `
              <div class="violation-section">
                <div class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  ìˆ˜ì • ê°€ì´ë“œ
                </div>
                <div class="fix-guide">
                  ${howToFix.action ? `<p style="margin-bottom: 12px; color: #e2e8f0;">${escapeHtml(howToFix.action)}</p>` : ''}
                  
                  ${fixSteps.length > 0 ? `
                    <div class="fix-steps">
                      ${fixSteps.map((step, i) => `
                        <div class="fix-step">
                          <span class="fix-step-number">${i + 1}</span>
                          <span>${escapeHtml(step.replace(/^\d+\.\s*/, ''))}</span>
                        </div>
                      `).join('')}
                    </div>
                  ` : ''}

                  ${(badExamples.length > 0 || goodExamples.length > 0) ? `
                    <div class="examples-grid">
                      ${badExamples.length > 0 ? `
                        <div class="example-box bad">
                          <div class="example-label">ì˜ëª»ëœ ì˜ˆì‹œ</div>
                          ${badExamples.slice(0, 2).map(ex => `
                            <div class="example-text">â€¢ ${escapeHtml(ex)}</div>
                          `).join('')}
                        </div>
                      ` : ''}
                      ${goodExamples.length > 0 ? `
                        <div class="example-box good">
                          <div class="example-label">ì˜¬ë°”ë¥¸ ì˜ˆì‹œ</div>
                          ${goodExamples.slice(0, 2).map(ex => `
                            <div class="example-text">â€¢ ${escapeHtml(ex)}</div>
                          `).join('')}
                        </div>
                      ` : ''}
                    </div>
                  ` : ''}

                  ${tips.length > 0 ? `
                    <ul class="tips-list" style="margin-top: 12px;">
                      ${tips.slice(0, 3).map(tip => `<li>${escapeHtml(tip)}</li>`).join('')}
                    </ul>
                  ` : ''}
                </div>
              </div>
            ` : ''}

            <!-- ê´€ë ¨ íŒë¡€ -->
            ${relatedCases.length > 0 ? `
              <div class="violation-section">
                <div class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                  </svg>
                  ê´€ë ¨ íŒë¡€/ì‚¬ë¡€
                </div>
                ${relatedCases.slice(0, 2).map(c => `
                  <div class="case-card">
                    <div class="case-header">
                      <span class="case-title">${escapeHtml(c.title || c.id)}</span>
                      ${c.penalty ? `<span class="case-penalty">${escapeHtml(c.penalty)}</span>` : ''}
                    </div>
                    ${(c.court || c.date) ? `
                      <div class="case-meta">${escapeHtml(c.court || '')} ${c.date ? `(${c.date})` : ''}</div>
                    ` : ''}
                    ${c.summary ? `<div class="case-summary">${escapeHtml(c.summary)}</div>` : ''}
                  </div>
                `).join('')}
              </div>
            ` : ''}

            <!-- ìŠ¤í¬ë¦°ìƒ· (ìˆëŠ” ê²½ìš°) -->
            ${screenshotData ? `
              <div class="violation-section">
                <div class="section-title">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                  ìœ„ë°˜ ì˜ì—­ ìŠ¤í¬ë¦°ìƒ·
                </div>
                <div class="screenshot-container">
                  <img src="${screenshotData.startsWith('data:') ? screenshotData : 'data:image/png;base64,' + screenshotData}" class="screenshot-image" alt="ìœ„ë°˜ ì˜ì—­ ìŠ¤í¬ë¦°ìƒ·">
                </div>
              </div>
            ` : ''}

          </div>
        </div>
      `;
    }

    // ë¬¸ë§¥ ë‚´ì—ì„œ ìœ„ë°˜ í…ìŠ¤íŠ¸ë§Œ í•˜ì´ë¼ì´íŠ¸ (mark íƒœê·¸ ì‚¬ìš©)
    function highlightInContext(context, matchedText, isWarning = false) {
      if (!context) return '';
      if (!matchedText) return escapeHtml(context);

      const escapedContext = escapeHtml(context);
      const escapedMatch = escapeHtml(matchedText);
      
      const markClass = isWarning ? 'highlight-mark warning' : 'highlight-mark';
      
      // ëŒ€ì†Œë¬¸ì ë¬´ì‹œí•˜ê³  ë§¤ì¹­, ì›ë³¸ í…ìŠ¤íŠ¸ ìœ ì§€
      const regex = new RegExp(`(${escapeRegExp(escapedMatch)})`, 'gi');
      return escapedContext.replace(regex, `<mark class="${markClass}">$1</mark>`);
    }

    // ì •ê·œì‹ íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ë·°ì–´ URL ìƒì„±
    function getViewerUrl(data) {
      if (!currentSourceUrl) return '#';
      
      const violations = data.raw?.violations || [];
      const warnings = data.raw?.warnings || [];
      const allViolations = [...violations, ...warnings];
      
      // ë·°ì–´ì— ì „ë‹¬í•  ë°ì´í„° (í•„ìˆ˜ í•„ë“œë§Œ)
      const violationsData = allViolations.map(v => ({
        matchedText: v.matchedText || v.evidence?.matchedText || '',
        severity: v.severity || 'warning',
        ruleId: v.ruleId || '',
        ruleName: v.ruleName || '',
      }));

      const violationsParam = encodeURIComponent(JSON.stringify(violationsData));
      return `/viewer?url=${encodeURIComponent(currentSourceUrl)}&violations=${violationsParam}`;
    }
  </script>
</body>
</html>
